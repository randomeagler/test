<html>
<head>
<title>Eaglercraft Server Embed Test</title>
<script>
    /*
MIT License

Copyright (c) 2022 Calder Young

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
const CHAR_WIDTHS = [
	1,9,9,8,8,8,8,7,9,8,9,9,8,9,9,9,
	8,8,8,8,9,9,8,9,8,8,8,8,8,9,9,9,
	4,2,5,6,6,6,6,3,5,5,5,6,2,6,2,6,
	6,6,6,6,6,6,6,6,6,6,2,2,5,6,5,6,
	7,6,6,6,6,6,6,6,6,4,6,6,6,6,6,6,
	6,6,6,6,6,6,6,6,6,6,6,4,6,4,6,6,
	3,6,6,6,6,6,5,6,6,2,6,5,3,6,6,6,
	6,6,6,6,4,6,6,6,6,6,6,5,2,5,7,6,
	6,6,6,6,6,6,6,6,6,6,6,4,6,3,6,6,
	6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,
	6,3,6,6,6,6,6,6,6,7,6,6,6,2,6,6,
	8,9,9,6,6,6,8,8,6,8,8,8,8,8,6,6,
	9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
	9,9,9,9,9,9,9,9,9,6,9,9,9,5,9,9,
	8,7,7,8,7,8,8,8,7,8,8,7,9,9,6,7,
	7,7,7,7,9,6,7,8,7,6,6,9,7,6,7,1
];

const CHAR_SHADOW_BRIGHTNESS = 0.247;

const SERVER_ASPECT_RATIO = 38.0 / 256.0;

class ServerEmbed {
	
	constructor(tag, width) {
		this.containerTag = tag;
		tag.style.width = width;
		tag.style.height = Math.floor(tag.clientWidth * SERVER_ASPECT_RATIO) + "px";
		tag.style.backgroundColor = "black";
		this.canvas = document.createElement("canvas");
		this.canvas.width = tag.clientWidth;
		this.canvas.height = tag.clientHeight;
		tag.appendChild(this.canvas);
		this.ctx = this.canvas.getContext("2d");
		if(!this.ctx) {
			throw new Error("CanvasRenderingContext2D is not supported in this browser");
		}
		this.ctx.imageSmoothingEnabled = false;
		this.tmpCanvas = document.createElement("canvas");
		this.tmpCanvas.width = 64;
		this.tmpCanvas.height = 64;
		this.tmpCtx = this.tmpCanvas.getContext("2d");
		this.tmpCtx.imageSmoothingEnabled = false;
		const self = this;
		this.spriteSheet = document.createElement("img");
		this.spriteSheet.addEventListener("load", () => {
			self.isSpriteSheetLoaded = true;
			setInterval(() => self.redraw(), 50);
		});
		this.spriteSheet.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAACACAYAAABdhGZrAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSkUqIhYUcchQnSyIijhKFYtgobQVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6OSk6CIl/i8ptIjx4Lgf7+497t4BQqPCVDMwAaiaZaTiMTGbWxWDrwhAwCD64ZOYqSfSixl4jq97+Ph6F+VZ3uf+HL1K3mSATySeY7phEW8Qz2xaOud94jArSQrxOfG4QRckfuS67PIb56LDAs8MG5nUPHGYWCx2sNzBrGSoxNPEEUXVKF/Iuqxw3uKsVmqsdU/+wlBeW0lzneYI4lhCAkmIkFFDGRVYiNKqkWIiRfsxD/+w40+SSyZXGYwcC6hCheT4wf/gd7dmYWrSTQrFgK4X2/4YBYK7QLNu29/Htt08AfzPwJXW9lcbwOwn6fW2FjkC+raBi+u2Ju8BlzvA0JMuGZIj+WkKhQLwfkbflAMGboGeNbe31j5OH4AMdbV8AxwcAmNFyl73eHd3Z2//nmn19wME23J76kXzXwAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAOwQAADsEBuJFr7QAAAAd0SU1FB+YEBAQQFs80bHQAACAASURBVHja7V1JbBzXmf6qunpvbqLExdRGyVZgBIgNKYAYI0oEDJAJJvHM1YAvsc4DWECOA2OcyWEOc5GAOXOCYAI4tzgGBkGAQZQwCUhFCmRN4mijSJGiyKbI5tLsvatrDtT//LpUVe+9WppNig9o9FLbq+p//f7laZAYlmVZTr9rmqapbNc0TeM/O13H6Xf7Nbz2cdumem+ia/k93r6/2zMUHcfvJzsH+7O3LMv6xS9+gVd56DIEorkM68XwOpbf7vaZ/+50Prd9Ozks23AiMn6oMBRPmDJCxe38Ttd3YxA/wuKVZAAZ4rX/sUGlsEgaehGRCkPKEpeIQPnfvDRcGMzrdQ9uDGpngkPi98EAIgIXMYiqCcETtBODyGiTMBk4yP07EaZfAvTSNE6/25nSiVlf5WH4JVSRVHay+532F20PwkDdIOWc7G63ZxAGgxyOLtQAImbx+u5l78psD0uDRWkCio5XldR2RnIz0Q6ZTIEBZB6al1qVJViR+eHne9D5i2x8FSdWFiyQ8WlE2/m5yDjGr+IIZGbIwqBhmRFu547ChJI9j8zxIo3oZi65mUyiY9xMQSdz7NNPP321NYCMJHCCQL0kq5cj5vXdaciYLKL5eUl4N+jQ6Tyi493moQKRyji2KlrN6395lU0gTdOg6/quCaSCCLjtGxQFkrGB7cTgF20Kc/6qEGUYWlDlGpZgvEpEH4/H0d/fj+HhYYyNjeHUqVPtKJCsxJXZFiYKY0dJVB040fzCmj8/TzcfQdWEkZ3fIc4vHul0GoODg+AfjS6SJDKSQmQCydjYMgzmR/LLzC/I/N0kqpMT60f6ikxHkUZTjUof5OH0yA1ZSC5KdRn0GqpOugxxeJ3fSxPZzy3Kf5LVKk73I0Jz+DQWN0f8VeEBTdNgmibq9TqazSYajQaazWY7A8hIC5VcHTdoM4hpEeR4v3OQPd5tfm6mkSzSFXT+YTDifiJ0AIjFYojH40gkEojH4zAMA4ZhoFAooNlstmsAVWJwQmG8/iAvCabqJIsIKSoCkDnej7mhaiqKAIMgkG4Q02J5eRmGsStP+/r6kEwm98TJHRwcRDweRywWg5OGy+Vy2Nzc/JIBguSkyBKISqDKjYG88HA/DqQfYjp0LF8eGxsbePjwIW7evAnTNKHrOt555x28+eabyGQyHZ9PKpVyNOvoL08kEtB1Ha1Wy90HUEVD+H288vxFJoBMjYBq7o/ouiLz5aCZDQ5RYd/nqtfruHHjBh4+fIhms4lEIoF6vY6pqSmsra3hO9/5DnRd79i9aZoGy7LQarVgmiaazSZ7p8+WZcGyLHbfRrf8KTLEJmISv/Cf13Fu6QRhXmOviD/oqNfrKBaLaDabjLAAoNlsolQqYWtrCz09PWi1WkgkEpHfX7PZRD6fVzrGCOuhehGn/d0u0YNCdaLri0ykINewxxNeNTOJpC4RIJkbT58+xU9/+lP09/fj7NmzeOedd9q0AS+JvUwWr32cjqnX64jH423788xJGoI+GyE8AGGSmxeT2B1oP+WOXkGgqAlSpswziDkVJM8pag2k6zpyuRxarRbq9Tosy4Ku6zAMA9VqFQDw7Nkz5HI5NBoNWJaFzc1NlEolFItFrK+v49SpUzh9+jRisRgj2mq1ikePHqFcLmN5eRnHjh3DuXPncPTo0ZfMNvvjsSwLjUajjTG90PXITSCRBnByeL2krJcG2gsJLNIAQbVDGPcT1XPJZDL43ve+h6GhIfzhD39AsVhEKpVCIpFAo9Fg9veTJ0/wm9/8BslkEnNzc2i1WtA0DY1GA0tLS1hYWEBPTw8GBwdx8uRJLCws4Le//S2KxSI0TcPKygoymQyOHz+OdDoNwzAYwxQKBdRqtZeYQDakZET9B4g0gCq+LXJ2g8zP73X3UjIHPd7voTyRff3rX0dPTw8+/fRTjIyMoFAooF6vs30rlQoePHiAdDqNVqvFMHoAKJVKWF5exvr6Oubn57G8vAzTNLGzswPTNAEA29vbmJmZQTqdxuXLlxncapomstksNE17iQlC8wGilqoiCSnjI9gjo2HGCMJCgfbKN4jq/6vValhcXMT9+/dhWRYSiQQ0TUO5XEalUkGj0WD7ptNppFIpxnDNZpNBkYZhoNVqoVqtIhaL4ebNm9jZ2UGz2WwzYyqVCr744gucP38e2WwWtVoNW1tbyOVyge7D6MQfJ/ITRD6EaL8wbP6ggao9dEK1gNuVr9lqtfC73/0Os7OzSKVSDPFptVpYX19HLBZDKpWCaZro7+9HOp1mWsM0TSSTSUbYJL3Jb6jVasxRpbnV63VmAtVqNVQqFfzxj3/EgwcPMDg4iG984xvMP3C7P13Xoes6YrEYYrEY+2zYzZCgTqhM7r7IX/BT7CKS4F7HhzX/oATst6+RStFOSD4FNjY2GOpCyIuu66jVaojFYshkMiwNgQg6FovBMAzoug7TNJkZBOymLpimiaGhITx79oxpCXpls1m8/vrrAIClpSXcuXMH5XIZ+XweqVQKly9fRi6XayNu/p1u2/5uyMCSMglXfr87ObOqUkwFSnXKWwoy/7Bg1iBOskqAMQyTSNM0JJNJ9PX1oVarIZ1Oo16vwzRNJv2JIVqtFkNlWq0WI8ZEIoFarcbeM5kMdF1HIpHA4OAgUqkUisUizpw5g0wmg29+85sYHR3FzZs3MTMzg+3tbQZn/ulPf0Jvby++//3vtxG7k8/SarXaPhsyhO7lYIaRPiBDRF7Se7+n/PpNkpNhgihMIF3XcerUKdy6dYvl/JCU3tnZYXY+ERsxAhFdq9Vi+TrNZhPJZBLVahXxeByVSgW5XA6VSgUAkEwmkUgksL6+jjfeeAOGYaBSqbyE55dKJZim2XYdInR+X1cfwEsCq8CdKvWufghYpKFUpbEoDiF6JkEFQFgMLAMAOG1PJBKMWGXH9vY2ZmdnEY/HUa1WWaZlpVKBruttkWEybYjZiBi3t7eRTqeZqUO+RTweR61WQ19fH9MesVgMDx8+RKVSwdDQEE6ePInFxUVUKhUcPXoUJ06cwLlz51CtVpUZ2ugUFOeF9gStNVAxsfyYCDK5SGHAxFGiPW7bM5kMI0rKmeHThe3DNE38/ve/R61WY5K9Xq/DMAxG6LzTycOelmUxuJLiAMlkEo1GA4ZhoFarsWQ2wzDQ09ODRqOBbDaLer2Ohw8fYmVlBd/61reQSCTw85//HN/+9rfx1ltv+c45Uk6HDuoDqDiknYBhgxJZGD6ATCqJqlaU1SSUwUnoSCKRQLFYdA0kNRoNhvjU63Ukk0mUy+U2c0TXdcZYvIYwTROGYTCI1DRNVqQSj8dhmiYajQZ0XWcmERWw0OdisYhf//rX0HUdW1tbbczmZN6J5JXOR1Hd/mBReaSoaazX+WUlpNvxUZ+fv7+o4yEyTXf9EL+X5rp//36b7WxPbKM8HHptbW1he3u7TbpT7j0RP/kF5CwbhsG2UXEKna/VaiGZTDKpT5VaFEkmJiqXy4jH420mU29vLxYXF3cl+Qsm4180N/s98C+hBgjDyQ1atBH1HIKcP0ymiDJVwm2/xcVFDAwMYGhoCK1WC8ViEY8ePcLm5iaGh4fR19eH/v5+RuQk6Vk+vWEgnU6z3B/SJs1mkxEhoT/kE6RSKebkNptNBlWSmUTXIv+BoFNiGE3TUKlU0NfXhydPnmBqaopFo1UdfcNJOqg4mSqlgn6OD6MplqhaTfQ9bEQrCIzqx+T0uod6vY75+XkGQxYKBSwvL8OyLMzNzSEej2NkZARvvPEGLMvC/Pw8k8yNRgM7OzvIZDJIp9Nt5gZJ8kQi0eYI06DgWLPZRLlcRrPZRDqdbjPJyC/gnWc6hn4zDIPFBM6fP4/e3l41H0A1xVc1mS3o8UEldAi5MlpY5k/QegU/jYBFz59s67/+9a84e/YsSqUSIzSCM7e2tmBZFpaWlvCXv/wFuVwOmUwGpmmiWq2iVCoxmx/YTVvgU6P5NAjTNBkCRN9N02wLUPHxAwqokZNOzKRpGss3Isas1Wo4f/48jh075ir1CTItFAq7/okMjKnSnzKKskK/EKsKFBu18xzEXLInFIbJpJlMhuXiUGSVCIU3N/72t7/h7t27qFQqiMVi2N7ehmmaDNXh8/vJj7BHXUlr1Ot1lEolBnEmEglm/xMqlE6nUSqVGIJULpfZeYgByFzSNA3VahVra2uYmprCV7/6VWSzWRw5coQly/Hj0aNHmJmZwbNnz+TSoVVMjiicxbCYSibSHAUzhFEwI4skqZ73yZMnOHr0KJLJJJaXl5ntDYClNZimiXv37mFtbY3Z8pVKBTs7O6hWqyy/J5vNIhaLwbIsJJNJhuaUy2Xkcrk257ZerzP4M5VKQdd1FjGu1+tIp9OstoCcWWKqcrnMUq3Jga7Vatjc3EQsFsPi4iL6+vpw9uxZnDt3Dq+99lqbyZfP5/H06dOXI8GdkIav8gjTnAqLCb744gt85StfwcjICDM/iOhIum9vbyOfz7cVk9frdQZ/0osGEWsqlWKmC+UN1Wo1NBoNpl2azWZbLhFJdPrd7syWy2Wsr6+jXC4zhzoWi6HRaLDfKPv09u3b6Ovrw9jYGDRNw/b2Nn75y1/i3r17LPhnRIFmRGEHd+vY7/dTKpVw9+5dPH78GCdOnMDw8DBSqRRSqRQjWCIWus18Ps/sfEpppsBYKpVCMplk0CppjEajgc3NTWxvbzP/gAi+WCwy3J9Sq4khaD9izmQy2TYfMsmoIo2c70KhgJGREWxvb7NjG40GFhYW2oJxRhhNl1RSCfxkW4bZ1MrvvckW4gTxcaKCVr3mRyYJADx8+BDlcpmVKCaTSZw4cQL5fB4rKyttzicfO6D4Qb1eZ0EwPkeIHONsNouNjY221AdiAvrMR6TJDCINsrm5iWKxyI4nLUWoFCFIrVYLhUIBADA2NoZisYje3l7GzASnsppgFZzbT5e3KOMMYV8/6vsLinD5OZ9gfm3w5draGtLpNHp7e1Gv16FpGvL5PGMSO5xJOD1/nnK5jHQ6zQpWqGYgm82yxlRkz5PpRMlx8Xgc8XicmVWWZWFrawtPnjxBsVhkkr/VarFYAk/4FOCqVCrY2NjAo0eP0Gg0UKlUkM/nUSgUGHzaarV2YdAocXwZHF7Fqe7G77JOtd+uFVHCvSS17TW8ZAbdunULz58/Z1I3Ho9jeHgYlUoF5XIZ29vbTAtQlDebzbJyRWIQ2ieXy6FcLrPr8UEuMo3I1ict0Wg0kEgk2gidtAshUdQJglKyyTFeX19HOp3G/Px8WyyBegcZUeP4srlAe2VLy3at8NquErhTdYxlu2f7dbB5hIUkbqVSwf3799Hb2wvDMHDkyBFsbW21mUt8CoRpmkin04jH4yx9mSBOIkqS6tRHiIdIydziyxvJdzAMg+H/NE8+eY+HWYlB+DSNer2OjY0NlEollkbR39/PnHhDRcpE5QN0OzoTtHC+U064HybgnVVCgOhzpVJh+Te0D+1PziaZHHwcgFAeOpZSHahWmPJ/qE0hHUdahhLiyP4nhjtz5gzK5TLrO9RqtXDq1ClmNi0sLKBcLmN0dBQ9PT2sa0Q+n2ed4UzTxPPnz5lWMsIgyqCR3m5BcoLMLSjGH1bbFB/JgNA0jdngsVgM2Wy2za6ndISenh4WAKtUKqhWq222N5kWlJcfi8VQrVZZcKvRaKCnp4fh/mR6Udc4XgOQw5pIJJgmoHwhPl2bJ+xUKoWdnR2GJJGJR44yMRjtD3RJa8QoTRgRgQaVoGExddQxArfR29vL7HXKxaHU5FwuB03TUCwWkclkUCqVWNSV2h0SYVIuEDEDpRzous7KF8k+B8ACWJQmQZqCIFVe8pN2qFarLJhG193c3GRahMysSqWC58+fI5vNtuUN8b4DwbdG1H90N/XEjCLIt9/jAMlkktn+1IiKMjspv4e6OBAyQ82v6HESAZIzSykKlLNPcCUxGDm0FMDK5XLMYaXIM70TxNpsNhkT8rlHpEVI8muahlKpxFqrECS7sbHBSikHBwcZLGrISia/UiqoDyBzvKwjGSUTyDjGfgpjoo7M89Ff+kxRXKrvTaVSMAyDESARHh+1pe2WZWFnZ4c5xRTg6unpQalUQiKRYHk+xDx0LtIEhDaRo0s1wpQ3RIE2noGoQJ9MMII56VwDAwMsPYP8j0QiIbc+gFffnaA4dBixAq99wlxkO6o4RZg2vYg57efki1l4guZTj8nB5ZmAcv6JiHlExqnKLJ1OMweYmI2uT5Keb4MSj8cZ6kTZoCThiQF4lKivrw/FYhGNRoP5IFRMk81mkclkGEpFqR29vb3O6dB7aQIESRn2G+kNE1+Pqm1KGACF03j77bdZNVbb6om6jtdffx1Pnz5FpVKBpmkYHR2FaZpYXV3F+Pg4VlZW0Gw2MTo6isXFRRw5cgSapmFtbY1Fk+/fv4/BwUH09fVhaWkJjUYDR44cwerqKo4ePYrnz58z4j927BjW1taYPzAwMIBisYhYLIahoSEsLi62dYwoFot48OABM6HefPNNPHnyBOl0GsePH0e9Xkd/fz+y2SwSiQTK5TJSqVRbddm+d4KjJqKgErzbx5EjR1hGJ9+GnC9K4ettyUwi6U54O2/GGIbBAlNU5N7X18cCYL29vWg2mxgYGGA2fKvVQi6Xa/NFMpkMiydQFJnKHSkaTIgUpWIQ+kQmF8GdNF8q/EmlUrumkmw7DdEfrLKqu6r0lolEq9QzqHaWC6IBwgARvPycoJF8cgxJCh89ehTpdBpPnz7Fzs4Oent7md1fKBRw+vRprK2tYXV1FQMDA1haWkKlUsHg4CDW19dx/PhxxONxzM/P48yZM3jttdewtLSEfD6Pe/fu4enTpxgdHcXo6CiLFNdqNYyNjWFpaQkDAwMsC5TMsYGBASwsLCCXy+HWrVsoFArIZDKssKZcLiOTybC5DA8Po6enB9VqFZ9//jnzcQg9Iv+BZYOq2LFBK8i8vssuCG33SVQrorz2iUqbhBUnCLsij5fohI3zyWp88Tr5CvZ3vkCFktZmZ2exsbGBkydPIplMMp+BUigoDYKcXXJuyeHmIVLKACWnnGIKPOxKxE0aZHV1lWWe8o+L7z0KAL7WyY2ydaBqro2q1A279aEsw/nVCnbCD/t+PvroI4t6dC4sLDDTg1AaMpGKxSKSySSDTamWl7I+SUsQwlMqlZDL5ZDL5Vj2KBFjoVBAKpVi9btUI0DEH4vFUCqVWMfoWCyG1dVVxpR2SW7PAeIT5ohJ+UAdDwAYfv/QTkrCMGp699L/CCPIFZVvcfPmTQC7qyuSLc4vcEFpBPS70+dUKsVy7KnXp67rKJVK2NzcbMvVIWar1WrI5/PMASeGooAWSXUyX/g2i+QH8IRMMQh7bbF9aSTSbm1tUYISUJBcIJnWg2EsEt0pXF2VCTpdJWa/DpkZ1JiWdiUbmY/G0n58ITvVB9g7NpC05YNkxAQEYfIQKs8k1GmOrkW1ARSI42uMyWyjhry8eUZz4L8TXCu9TGqUGH0ntouYJ4x8fdk1jMNYYDvsOMzOzg4jLD49maqrqMyQx90pIY5HY3hC4zF+Pv2AT3bjTRMiav7c9inz3SB4p53iFADaSij5ufG5RKQ56Npds0xqt8CYUV3DL8okE9+w76PyPIlASJLyTi1JYL4pFhEeL1f4luT2ghkyb3inm5fUfCMsPpWC386bN3yLdd7Otzfgrdfr7LxkcvGmEfkNByIOcJDjFCpLSPkJBvL1toTp8yYGOaWE1pAU5x1L3uwgM4oIkSS7vU2KPdLMS37SFva4BO/A0n50Pb7Qnk9+4006Ylze5DLsiWIijNwNVfCLw4tqbvd7RVgntY+fiDO1NKdiE7K5eYiRzxWi4nM+V4d3OJ0Cajyz8XXEJLntsKuT30DMSWuREdNRsI4K6u3mFRXXkzYjJmX3pYLjy3Qm81MRtpcZlbLp1GHESIKYaEGek9f9kd3MMwEllZG9TIRPREb78IRrdz7JZ+Ab0RJqRC9e0vNrCfCF6zy0yefx86YMXyHG5zTxBTx8sh+vDQw/f4KKFOqWirAwKr78nN9vnUJYZpSo3oF3YnlpTyYF4fA8ckPpBvb1eHmC5JmDJ3i+8ov3Q2gbQaAEgxLR0/xI4lMgzL4mAe8k84t389AnMX6j0RCXRIaBo0dZERZUgoskpCwMvF9rAviSR94pJQSHiIZWfeTtdT6CzDusvJTmnV47MfNlmPw57cEqvlqNgmp8GSVfPkmagGc2fj/KEKX5+UqFUCUuGZguyALYsseL0iBkUw2c7k9WiATJBQqindy2ETpCJgZvstiJlRxa2pfXALyk5U0qvncoT4iUy89Lav4W+dXgCY7lE+74Mk6+Co2fPw+/kgnG9y2VigRHjfF3ItYQBGdXjSOoziGKZsIqx5ME5zs0k7Sl9bqI4Hlo0o7q8N3XaH+y5XmN4rQME0/AZAIR8/DmE4/okB/CO968P8IzaywWYyndPJM0m82XO8OJljD1g1kHOb9K5+cgBe0i6e2miWRzffyus6yaS6S6RtqP/+kcZpd3u6gt5jcBAJffPvPSb/MrGzg9MsC237jzGJffPoO//5f/dpzXlStg9zQ56Z5zdvXq1T2JzF+7dg0ANEOl748faRX0/GFoEJVlVsOen+jZyWS7qgATqprmxp3HODHcj6nP5xiBzy4XsDV2CXf/56c4PTLAGIKYYXa5gPmVDfzkV7fhRvwffPDl98lJWPBIvLyGa3vmAxmiBxV0BZKwe4P66Vwnk04d9fxkGl85rQEmOj7o/0PS/PTIAOZXNvCD717AjTuPgfxnjPhv3HnM9p9f2WjfT3JcuXLFmpycFAqzTyY+wcWLF0Mn9JmZGbw3/Z6YAYLCf0FXgIliexAGjzp9OiyI1+//M7tcQHH4PN4d3cSNO4+ZdOcl/4nhfizmN3FiuP8lE0kk/QFgagq4dGlSeB9zH85F9owuXryIuYtzGL8+3va7rvIwvR6y2yqR3bBddH+dvH5UwTw37SEzv578nzG7XMDlt89g6vM5XHprnJlHADD1+S5hfoEzjGnoN69x6dLLWsBL8ndi2K8jXCZV9Q9wk7Ai9R7Vdpn785p/GNv3enjNbTG/ifmVDUbY5AeQqcP7Buuf/y87hjSEm/Qn4qf3qSlgcnLSU0J3YtivI2yOGzRf38/xYW73c39hbu/2cfntM/jJr24zB7f3/LtY/PNnbQROiA/vNC/mN13NoKC+wMzMTBvBen2fnp7GxMSE43b67MVcUovk7WU+f1hYeTffX5RxDJm4BU/ss0tT6HtB4ETs8ysbbcTO+wNetr99yPgCRLzT09Ou23min5iYYPtOTEy0bb9+/Tr7zY0JDCdTIcgKMXsRBwiCo8tcvxNOcJCuGn4BCzJ77JKdiJtMI/IJSEuQX0CmkYszjMnJ3XcVLUCE6iW17dvcvsuYVUZQ1S0K9ESNswfF0WWuL1vxFfQZRs1gbv8TxQF44ibNYCd8uynkJv0/+GCXAfwiQp0auuUw3CSQFwritl3GCQ2CsqimMvj5zjuRqserokQq5Z0y/43s+ckMuvz2GZweGcAPvnuBmT/0O2mM2eXCrq/AMYabyePlC3QDA0gnw8muoqIqoQ8CDq8i3d0KalRSKmSfvdM13JAg3hyi4NeJ4X4MvvV3mF1+3KYdLr01ju0/f4b5lQ1X2/+//usKJicnceXKFXzwwaSyFrh+/Xooz//DDz8UM4BsZ7bDNYSDM4JfAg6Sa+S1nWDQS2+NM/ufYgI37jxGD/6MRZumWMxvMo3w89m/+X4mXlpARLgd0wBhrJ7SzSPqvkFhaCUZFCjI+Yn4AeDxWh1xs8x8A2KQH3z3An7yq9ttEWKv8cEHky/sf3/2/p5oABHOLaspVHJtwt7uh8C98v3Dmp8oU9btHGGsc+x1jJ3Ib9x5zNAfSok4PTLQlvfDO8AvMj2tSUU6v+IED+2FBggLo97LtYCj7BsU1vW9otBBnr+shhOd4wffvcDyfoDdgNilpak2U+n0yADbzkeQJyeh+XFqJycnNbd06E5pACFmrlKR5EdDqKyzK4P0+MXRO9UUd7858bDGLWhzwvm8//771s9+9jPleV+9etW6hmuhJ8JdH29Pevtw7svzj18fx4sMbE23E5aTClfJyRdpArfzu+WriLbb91GFMWW1RBgJb36cXdnruQEVvgEMa/zL/f+9z/IifPo8MTHRFSDJ9fFxTHzyCXt9CGDcxhA0dPsfLDIRRAQiOt7pe5THqxCnDFGqOs2dSvOQXeh7PxM+nwMkIn4AuPjee7j43m4NwFUXJtBFElT24fs9Xub6IidXxgYWBeL82uIygUS/0l9GAKnCoK7n6yLCJ0KfmZlhvgDl89A2kY9AhC8aQg2wH6BKFRPJD/F7EY9MKrTsIiB+/gMZ4vZkEknCxz9akRK+U8bn9PQ0c2Ipr2d6ehozMzO+USK7FjE6vSxn2EwQhhMtY/KIoqlh+ABhID1erStdr+1F+Px4898s4H4k/+970+9h7uJcGxM4JbPJEL5d+l+3XadNA9hNBL8P383ECHp+GYgyiBMdRsGMCKES9RUKI5jldg7huQnhEb3/cvd4Qnrc3oOM8evjUna+J+w5N4fxF0R/nSP+a+QIeMGgh+NwdHoQDBrqOa/hpTN+8skn7dL/mo3+vdAWO5TGv9vNA6fPdodRhCb52S66dtChcm9+rh/G+aO4b97pDWM/p1sP83UVsOYwZ829+D734jeX/XfToXkV6bbYgtu703GHSXMHYHDOsZfTGwIqpIX1ugrgQ8wBGMcLwFO7DuDDduuHP2bXB3AjfDcHywm1iGqZ0agRKhGMGUZ8wW2Eff6wCX8/BcCuAhYRv6Nv8CUTtM01sAbwgvrCYISouy2Izh+044Oqk75nz6dL4NAwiH+c82+vvdACbkwQWAM4wZSiBTVUjLNpngAABTZJREFUJJjs9qASWOb6QXsmiarFZDSQVyTcj4bzI/F34dDuMdauvTB6ROlz19HmHFsAFwdwa9EnowHsppDfVIEgmL4ox8dtfkHPL3t/fnKQwt7ueg+ScYCJiQlruvu8Fa2NnR3QzWu73y0n5LPrfYDDETX5eOP/L+H8gnjA/nP2JYu8VaFQPzBdlDBoUBgx6PmjhmlVodaDOK7aHFzV7YEJNOo/YK8ZRHZu3Xq8n/N2IA4Qyfj4Y1j8y20//dAGOBxBYM5urAf4+GNYly/fwGefXcBnn10AAFy4cMF6ZRggLGzcjr6IECUVBEpmfpbCUEGgPI+TDIB1IxzKE/8Pf/hD3L59W7t9+7YGAO++e9uRCQ4kAwTFxlU6QTvh+JrCEF1fdfi+/v6HQ9kg4ueYQlMygURSJmzJpHqusPr1y+DyYc7fb+whyPmF++/j0scwRuDeoE4EFdXKh2GfX7WHaJD7UK1L6MT5meRXiAPsF8L2cnwPneDDwXGJHP4vGw/oBqJ/913nxfveffe2NGN0HKbcaxh0r2HKvZ7ffh8ffyxn+X38MSzeGdbDfICiuljaxy9O7aftSlgMJrOao8w53T47ObGyPgl/jKqvpgKHhrFfB1Sa4OXhAxyOw8ETNJk1ExMT1vT0tOYKh74whzz369D40Y/ct12+fAPAZTUGUOmrGaYp5XR+346eDyQoyvvbT4Qvs1+UxfKq41//1WvrZdy4oagB9oIAokKRROcKs45h3w2uBaIs4XdjdqiyBpCpBQ6TmO3nD2tldtUWgl7H+L1vv/UCeylM2np//nufhb8E0wz7TgP4wZq9iNKpMEZWqvrB7522iZr8ilqVB9UA+6HPUts4IHGAH/0oYsW9l10Zgl6/E10VvK4b1pCdg9K9EAO8eCdCl32nlIi9ZJALFy5Ysi87ZqSsrv1ogDCdYz/X74QGkG3/HqVJs58X7X4lh19J1+nrh5F/FGaWqkptcJBnK43v/+P+DLzpfohEhYBk1XmQIJbbNd2Iw17KafdVRJrBDTgQNcANep8iLSOauwpg4KceoFuzQ4UMIOrwJvMAvdKHvT471SA7/Yl+tYSo7YsIGbLvbz+PaLsMWuUn+1V23TbVsZ8LYXwxgAyBOElNLxtV9c+QlZx+ruHWi0dVQobRGsWL4ZyEg9szd5pnUPPqVSN8RxPIq5OwqgoNy7ntluHV2MpLIodl+vidn/jhj7+ShO/IAF7rSclqgKDEH0SK+ZmjqrQN+xm4SXMvoePXrhfCoIJxkAjfU72rYPoqta0iB1XG0fY7B9F+fhEcmWqvsLrLqfyHsgABzwCq+L9bPGA/jcBLn3YD8waZn9+Obfvl/g5HyFoiKgksI+3DmIOf60albd1qeDs9Nwuw/s2haZTb7wfW/Nmrrm4yplIQBhC1JO9kNVWQarBOMgF9HxoassbGxg4sExiqoXU3lcxXekWVZCbjTHqZEFE58t1gCgVNgdAAzXqxcspHAH4M4D96enB6eBjZbBZLS0sHkgF0kQaQiZSK/iA/SIUspKcyf1ko04vI9qqnZ9RM+/7771saoBHx/+fQEHp7e/G1r33tQFtAukrDpiB/UFQxBJn5y6zKEsZCE34QrLDRID+EDwB3796FBVg/BvARgH9eXcWJEycOvG+ry/oAMp3MwpLqYTrYspHuMLSSKOosc1wUq8iIxsTEhHX3//6PSf7jY2P4CMA/TE/jlR9+k91UnexudhCjQn+6Zm4vHN6enp42XJ9+P7ABMHTZOsGiPP396LwexPs4SOP/AbezVzOqUt0qAAAAAElFTkSuQmCC";
		this.socket = null;
		this.connected = false;
		this.dirty = false;
		this.connecting = 0;
		this.currentStatus = {
			serverName: "",
			serverCracked: false,
			pingSentTime: 0,
			pingToServer: -1,
			motdLine1: "",
			motdLine2: "",
			onlineCount: 0,
			maxCount: 0,
			players: []
		};
		this.showCracked = true;
		this.tooltip = "";
		this.isShowingTooltip = false;
		this.isTooltipEnabled = true;
		this.tooltipCanvas = document.createElement("canvas");
		this.tooltipCanvas.width = 64;
		this.tooltipCanvas.height = 64;
		this.tooltipCanvas.style.display = "none";
		this.tooltipCanvas.style.position = "fixed";
		this.tooltipCanvas.style.zIndex = "100";
		this.tooltipCanvas.style.pointerEvents = "none";
		this.tooltipCtx = this.tooltipCanvas.getContext("2d");
		this.tooltipCtx.imageSmoothingEnabled = false;
		document.body.appendChild(this.tooltipCanvas);
		this.mouseOver = false;
		this.mouseX = 0;
		this.mouseY = 0;
		this.mousePageX = 0;
		this.mousePageY = 0;
		var mouseMove = (e) => {
			self.mouseOver = true;
			self.mouseX = e.offsetX / self.canvas.width * 256.0;
			self.mouseY = e.offsetY / self.canvas.height * 38.0;
			self.mousePageX = e.clientX;
			self.mousePageY = e.clientY;
		};
		this.canvas.addEventListener("mouseover", mouseMove);
		this.canvas.addEventListener("mousemove", mouseMove);
		this.canvas.addEventListener("mouseout", (e) => {
			self.mouseOver = false;
			self.tooltipCanvas.style.display = "none";
		});
		this.lastWidth = 0;
		this.redrawTimer = 0;
	}
	
	setShowCracked(b) {
		if(b != this.showCracked) {
			this.showCracked = b;
			this.dirty = true;
		}
	}
	
	setShowTooltip(b) {
		this.isTooltipEnabled = b;
	}
	
	getPixelX(x) {
		return x * this.canvas.width / 256.0;
	}
	
	getPixelY(y) {
		return y * this.canvas.height / 38.0;
	}
	
	drawIcon(x, y, w, h, dx, dy, dw, dh) {
		if(this.isSpriteSheetLoaded) {
			this.ctx.drawImage(this.spriteSheet, x + 0.05, y + 0.05, w - 0.1, h - 0.1, this.getPixelX(dx),
			this.getPixelY(dy), this.getPixelX(dw||w), this.getPixelY(dh||h));
		}
	}
	
	drawChar(x, y, ch, italic) {
		if(ch >= CHAR_WIDTHS.length) {
			ch = 176;
		}
		if(!italic) {
			this.drawIcon(ch % 16 * 8, Math.floor(ch / 16.0) * 8.0, CHAR_WIDTHS[ch], 8, x, y);
		}else {
			if(this.isSpriteSheetLoaded) {
				this.ctx.resetTransform();
				this.ctx.scale(this.canvas.width / 256.0, this.canvas.height / 38.0);
				this.ctx.translate(x + 1.1, y);
				this.ctx.transform(1, 0, -0.35, 1, 0, 0);
				this.ctx.drawImage(this.spriteSheet, ch % 16 * 8, Math.floor(ch / 16.0) * 8.0,
					CHAR_WIDTHS[ch] * 0.99, 8 * 0.99, 0, 0, CHAR_WIDTHS[ch], 8);
				this.ctx.resetTransform();
			}
		}
		return CHAR_WIDTHS[ch];
	}
	
	drawColoredChar(x, y, ch, color, italic) {
		if(ch >= CHAR_WIDTHS.length) {
			ch = 176;
		}
		if(!this.isSpriteSheetLoaded) {
			return CHAR_WIDTHS[ch];
		}
		this.tmpCtx.globalCompositeOperation = "source-over";
		this.tmpCtx.clearRect(0, 0, 8, 8);
		this.tmpCtx.imageSmoothingEnabled = false;
		this.tmpCtx.drawImage(this.spriteSheet, ch % 16 * 8, Math.floor(ch / 16.0) * 8.0,
			CHAR_WIDTHS[ch] * 0.99, 8 * 0.99, 0, 0, CHAR_WIDTHS[ch], 8);
		this.tmpCtx.globalCompositeOperation = "source-in";
		this.tmpCtx.fillStyle = color;
		this.tmpCtx.fillRect(0, 0, CHAR_WIDTHS[ch], 8);
		
		if(!italic) {
			this.ctx.drawImage(this.tmpCanvas, 0, 0, CHAR_WIDTHS[ch] * 0.99, 8 * 0.99, this.getPixelX(x),
			this.getPixelY(y), this.getPixelX(CHAR_WIDTHS[ch]), this.getPixelY(8));
		}else {
			this.ctx.resetTransform();
			this.ctx.scale(this.canvas.width / 256.0, this.canvas.height / 38.0);
			this.ctx.translate(x + 1.1, y);
			this.ctx.transform(1, 0, -0.35, 1, 0, 0);
			this.ctx.drawImage(this.tmpCanvas, 0, 0, CHAR_WIDTHS[ch] * 0.99, 8 * 0.99, 0, 0, CHAR_WIDTHS[ch], 8);
			this.ctx.resetTransform();
		}
		return CHAR_WIDTHS[ch];
	}
	
	drawCharLine(x, y, w, clr) {
		this.ctx.fillStyle = clr;
		this.ctx.fillRect(this.getPixelX(x), this.getPixelY(y), this.getPixelX(w + 0.02), this.getPixelY(1));
	}
	
	makeColor(r, g, b) {
		return "rgba(" + Math.floor(r) + "," + Math.floor(g) + "," + Math.floor(b) + ",1.0)";
	}
	
	getStringWidth(txt, escapeChar) {
		if(!escapeChar) {
			escapeChar = 167;
		}else {
			escapeChar = escapeChar.charCodeAt(0);
		}
		var j = 0;
		for(var i = 0; i < txt.length; ++i) {
			var c = txt.charCodeAt(i);
			if(c == escapeChar) {
				i += 2;
			}else {
				if(c < CHAR_WIDTHS.length) {
					j += CHAR_WIDTHS[c];
				}else {
					j += 6;
				}
			}
		}
		return j;
	}
	
	drawString(x, y, txt, r, g, b, shadow, randomSeed, escapeChar) {
		var escapeCharChar = escapeChar;
		if(!escapeChar) {
			escapeChar = 167;
		}else {
			escapeChar = escapeChar.charCodeAt(0);
		}
		var startX = x;
		var startY = y;
		if(shadow) {
			++x;
			++y;
		}
		if(!randomSeed) {
			randomSeed = 3492589035;
		}
		var readFormat = false;
		var cr = r;
		var cg = g;
		var cb = b;
		var obfuscate = false; var bold = false; var strikethrough = false;
		var underline = false; var italic = false;
		for(var i = 0; i < txt.length; ++i) {
			var c = txt.charCodeAt(i);
			if(c == escapeChar) { // color code symbol
				readFormat = true;
				continue;
			}
			if(readFormat) {
				if(c == 48) { // black (0)
					cr = cg = cb = 0;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 49) { // dark_blue (1)
					cr = cg = 0;
					cb = 170;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 50) { // dark_green (2)
					cr = cb = 0;
					cg = 170;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 51) { // dark_aqua (3)
					cr = 0;
					cg = cb = 170;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 52) { // dark_red (4)
					cr = 170;
					cg = cb = 0;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 53) { // dark_purple (5)
					cr = cb = 170;
					cg = 0;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 54) { // gold (6)
					cr = 255;
					cg = 170;
					cb = 0;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 55) { // gray (7)
					cr = cg = cb = 170;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 56) { // dark_gray (8)
					cr = cg = cb = 85;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 57) { // blue (9)
					cr = cg = 85;
					cb = 255;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 97) { // green (a)
					cr = cb = 85;
					cg = 255;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 98) { // aqua (b)
					cr = 85;
					cg = cb = 255;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 99) { // red (c)
					cg = cb = 85;
					cr = 255;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 100) { // light_purple (d)
					cr = cb = 255;
					cg = 85;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 101) { // yellow (e)
					cr = cg = 255;
					cb = 85;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 102) { // white (f)
					cr = cg = cb = 255;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}else if(c == 107) { // obfuscated (k)
					readFormat = false;
					obfuscate = true;
					continue;
				}else if(c == 108) { // bold (l)
					readFormat = false;
					bold = true;
					continue;
				}else if(c == 109) { // strikethrough (m)
					readFormat = false;
					strikethrough = true;
					continue;
				}else if(c == 110) { // underline (n)
					readFormat = false;
					underline = true;
					continue;
				}else if(c == 111) { // italic (o)
					readFormat = false;
					italic = true;
					continue;
				}else if(c == 114) { // reset (r)
					cr = r;
					cg = g;
					cb = b;
					readFormat = obfuscate = bold =
					strikethrough = underline = italic = false;
					continue;
				}
				readFormat = false;
				continue;
			}
			if(obfuscate) {
				this.dirty = true;
				var w = 6
				if(c < CHAR_WIDTHS.length) {
					w = CHAR_WIDTHS[c];
				}
				var j = 0;
				var newChar = 0;
				do {
					var t = randomSeed += 0x6D2B79F5;
					t = Math.imul(t ^ t >>> 15, t | 1);
					t ^= t + Math.imul(t ^ t >>> 7, t | 61);
					newChar = (((t ^ t >>> 14) >>> 0) / 429496) & 255;
				}while((newChar == c || CHAR_WIDTHS[newChar] != w) && ++j < 1000);
				c = newChar;
			}
			if(shadow) {
				var ccc = this.makeColor(cr * CHAR_SHADOW_BRIGHTNESS,
						cg * CHAR_SHADOW_BRIGHTNESS, cb * CHAR_SHADOW_BRIGHTNESS);
				var ox = x;
				var ow = 0;
				if(bold) this.drawColoredChar(x + 1, y, c, ccc, italic);
				x += (ow = this.drawColoredChar(x, y, c, ccc, italic));
				if(bold) {
					++x;
					++ow;
				}
				if(strikethrough) this.drawCharLine(ox, y + 4, ow, ccc);
				if(underline) this.drawCharLine(ox, y + 8, ow, ccc);
			}else {
				if(cr >= 250 && cg >= 250 && cb >= 250) {
					var ox = x;
					var ow = 0;
					if(bold) this.drawChar(x + 1.0, y, c, italic);
					x += (ow = this.drawChar(x, y, c, italic));
					if(bold) {
						++x;
						++ow;
					}
					if(strikethrough) this.drawCharLine(ox, y + 4, ow, "#FFFFFF");
					if(underline) this.drawCharLine(ox, y + 8, ow, "#FFFFFF");
				}else {
					var ccc = this.makeColor(cr,cg,cb);
					var ox = x;
					var ow = 0;
					if(bold) this.drawColoredChar(x + 1.0, y, c, ccc, italic);
					x += (ow = this.drawColoredChar(x, y, c, ccc, italic));
					if(bold) {
						++x;
						++ow;
					}
					if(strikethrough) this.drawCharLine(ox, y + 4, ow, ccc);
					if(underline) this.drawCharLine(ox, y + 8, ow, ccc);
				}
			}
			if(x > 250.0) {
				break;
			}
		}
		if(shadow) {
			this.drawString(startX, startY, txt, r, g, b, false, randomSeed, escapeCharChar);
		}
	}
	
	redraw() {
		if(this.dirty || (this.mouseOver && ++this.redrawTimer % 6 == 0) || this.canvas.width != this.containerTag.clientWidth) {
			this.dirty = false;
			if(this.canvas.width != this.containerTag.clientWidth) {
				this.containerTag.style.height = Math.floor(this.containerTag.clientWidth * SERVER_ASPECT_RATIO) + "px";
				this.canvas.width = this.containerTag.clientWidth;
				this.canvas.height = this.containerTag.clientHeight;
			}
			var tooltipNewArray = [];
			this.ctx.imageSmoothingEnabled = false;
			this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
			this.ctx.fillStyle = "#101010";
			this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
			this.ctx.strokeStyle = "#808080";
			this.ctx.lineWidth = this.getPixelX(1.0);
			this.ctx.strokeRect(this.ctx.lineWidth / 2, this.ctx.lineWidth / 2,this.canvas.width - this.ctx.lineWidth,this.canvas.height - this.ctx.lineWidth);
			
			if(!this.iconCanvas) {
				this.drawIcon(128, 0, 64, 64, 4, 4, 30, 30);
			}else {
				this.ctx.drawImage(this.iconCanvas, 0, 0, 64, 64, this.getPixelX(4),
				this.getPixelY(4), this.getPixelX(30), this.getPixelY(30));
			}
			
			var v = Date.now();
			var drawAddress = false;
			
			this.drawString(38, 4, this.currentStatus.serverName, 255, 255, 255, true, v);
			if(this.currentStatus.pingToServer >= 0) {
				if(this.currentStatus.motdLine1.length > 0) {
					this.drawString(38, 15, ""+this.currentStatus.motdLine1, 255, 255, 255, true, v);
				}
				if(this.currentStatus.motdLine2.length > 0) {
					this.drawString(38, 27, ""+this.currentStatus.motdLine2, 255, 255, 255, true, v);
				}else {
					drawAddress = true;
				}
			}else if(v - this.connecting < 15000) {
				this.dirty = true;
				var dots = Math.floor(v / 300) % 4;
				this.drawString(38, 15, "Connecting" + (dots > 0 ? "." : "") + (dots > 1 ? "." : "") + (dots > 2 ? "." : ""), 128, 128, 128, true, v);
				drawAddress = true;
			}else {
				this.drawString(38, 15, "No Connection", 96, 96, 96, true, v);
				drawAddress = true;
			}
			if(drawAddress && this.showAddress) {
				this.drawString(38, 27, this.originalAddress, 48, 48, 48, true, v);
			}
			var mouseIsOverPing = this.mouseOver && this.mouseX >= 233 && this.mouseX <= 256 && this.mouseY >= 1 && this.mouseY <= 11;
			var mouseIsOverPlayers = false;
			if(this.currentStatus.pingToServer >= 0) {
				if(mouseIsOverPing) tooltipNewArray = [""+this.currentStatus.pingToServer+"ms"];
				var i = 5;
				if(this.currentStatus.pingToServer < 150) i = 0;
				else if(this.currentStatus.pingToServer < 300) i = 1;
				else if(this.currentStatus.pingToServer < 600) i = 2;
				else if(this.currentStatus.pingToServer < 1000) i = 3;
				else i = 4;
				this.drawIcon(128, 80 + i * 8, 10, 7, 243, 3);
				var onlineStr = "" + this.currentStatus.onlineCount + "/" + this.currentStatus.maxCount;
				var xx = 253 - this.getStringWidth(onlineStr);
				mouseIsOverPlayers = !mouseIsOverPing && this.mouseOver && this.mouseX >= xx - 5 && this.mouseX <= 256
					&& this.mouseY >= 12 && this.mouseY <= 23;
				this.drawString(xx, 14, onlineStr, 128, 128, 128, true);
				if(mouseIsOverPlayers) {
					tooltipNewArray = this.currentStatus.players;
				}
			}else {
				if(v - this.connecting < 7000 || this.connected) {
					this.dirty = true;
					if(mouseIsOverPing) tooltipNewArray = ["Connecting..."];
					this.drawIcon(138, 80 + Math.abs(Math.floor(v / 100.0) % 8 - 4) * 8, 10, 7, 243, 3);
				}else {
					if(mouseIsOverPing) tooltipNewArray = ["No Connection"];
					this.drawIcon(128, 120, 10, 7, 243, 3);
				}
			}
			if(this.showCracked && this.currentStatus.pingToServer >= 0) {
				if(this.currentStatus.serverCracked) {
					this.drawIcon(144, 64, 16, 16, 243, 25, 10, 10);
				}else {
					this.drawIcon(176, 96, 16, 16, 243, 25, 11, 11);
				}
				if(!mouseIsOverPlayers && this.mouseOver && this.mouseX >= 239 && this.mouseX <= 256
					&& this.mouseY >= 22 && this.mouseY <= 36) {
					if(this.currentStatus.serverCracked) {
						tooltipNewArray = ["Server is cracked"];
					}else {
						tooltipNewArray = ["Server has login"];
					}
				}
			}
			if(!tooltipNewArray || !this.mouseOver || tooltipNewArray.length == 0) {
				this.tooltipCanvas.style.display = "none";
			}else {
				this.showTooltip(tooltipNewArray);
			}
		}
	}
	
	ping(addr, name, forceName, hideAddress, hideCracked) {
		if(!name) {
			name = "Minecraft Server";
			this.showQueryName = (typeof forceName === "undefined") || !forceName;
		}else {
			this.showQueryName = (typeof forceName !== "undefined") && !forceName;
		}
		this.defaultName = name;
		this.showAddress = !hideAddress;
		this.originalAddress = addr;
		if(typeof hideCracked !== "undefined") {
			this.showCracked = !hideCracked;
		}
		if(addr.indexOf("ws://") != 0 && addr.indexOf("wss://") != 0) {
			addr = (window.location.href.indexOf("https:") == 0 ? "wss" : "ws") + "://" + addr;
		}
		if(this.socket != null && this.connected) {
			this.socket.close();
		}
		this.currentStatus = {
			serverName: name,
			serverCracked: false,
			pingSentTime: Date.now(),
			pingToServer: -1,
			motdLine1: "Connecting...",
			motdLine2: "",
			onlineCount: 0,
			maxCount: 0,
			players: []
		};
		this.dirty = true;
		if(this.connected || this.connecting > 0) {
			this.socket.close();
			this.connected = false;
			this.connecting = 0;
			this.redraw();
		}
		this.connecting = Date.now();
		const self = this;
		this.socket = new WebSocket(addr);
		this.socket.binaryType = "arraybuffer";
		this.socket.onopen = () => {
			self.socket.send("Accept: MOTD");
			self.connecting = 0;
			self.connected = true;
			self.dirty = true;
		};
		this.socket.onmessage = (e) => {
			if(e.data) {
				if(typeof e.data === "string") {
					try {
						var dat = JSON.parse(e.data);
						if(dat["type"].toLowerCase() === "motd") {
							self.dirty = true;
							if(self.currentStatus.pingSentTime > 0) {
								self.currentStatus.pingToServer = Date.now() - self.currentStatus.pingSentTime;
								self.currentStatus.pingSentTime = 0;
							}
							if(this.showQueryName) {
								self.currentStatus.serverName = dat["name"];
							}else {
								self.currentStatus.serverName = this.defaultName;
							}
							self.currentStatus.serverCracked = dat["cracked"];
							var lns = dat["data"]["motd"];
							if(lns && lns.length > 0) {
								self.currentStatus.motdLine1 = lns[0];
								if(lns.length > 1) {
									self.currentStatus.motdLine2 = lns[1];
								}
							}
							self.currentStatus.onlineCount = dat["data"]["online"];
							self.currentStatus.maxCount = dat["data"]["max"];
							self.currentStatus.players = dat["data"]["players"]||[];
						}
					}catch(e) {
						self.currentStatus.motdLine1 = "ERROR: " + e;
					}
				}else {
					var dat = new Uint8Array(e.data);
					if(dat.length == 64*64*4) {
						this.updateIconFromBytes(dat);
						this.dirty = true;
					}
				}
			}
		};
		this.socket.onclose = (e) => {
			self.connecting = 0;
			self.connected = false;
			self.dirty = true;
		};
		this.socket.onerror = (e) => {
			if(self.connected || self.connecting > 0) {
				self.socket.close();
			}
			self.connecting = 0;
			self.connected = false;
			self.dirty = true;
		};
	}
	
	isActive() {
		return self.connecting > 0 || self.connected;
	}
	
	setTooltip(ttList) {
		if(this.isTooltipEnabled) {
			var tst = ttList.join();
			if(tst !== this.tooltip || this.lastWidth !== this.canvas.width) {
				var listWidth = 0;
				var listHeight = ttList.length * 9;
				for(var i = 0; i < ttList.length; ++i) {
					listWidth = Math.max(listWidth, this.getStringWidth(ttList[i]));
				}
				listWidth += 6;
				listHeight += 3;
				this.tooltipCanvas.width = this.getPixelX(listWidth);
				this.tooltipCanvas.height = this.getPixelY(listHeight);
				var mainCtx = this.ctx;
				this.ctx = this.tooltipCtx;
				this.ctx.imageSmoothingEnabled = false;
				this.ctx.clearRect(0, 0, this.tooltipCanvas.width, this.tooltipCanvas.height);
				this.ctx.fillStyle = "#101010E0";
				this.ctx.fillRect(0, 0, this.tooltipCanvas.width, this.tooltipCanvas.height);
				for(var i = 0; i < ttList.length; ++i) {
					this.drawString(3, (2 + i*9), ttList[i], 256, 256, 256, true);
				}
				this.ctx = mainCtx;
				this.tooltip = tst;
				this.lastWidth = this.canvas.width;
			}
		}
	}
	
	showTooltip(ttList) {
		this.dirty = true;
		if(!this.mouseOver) {
			this.tooltipCanvas.style.display = "none";
			return;
		}
		this.setTooltip(ttList);
		this.tooltipCanvas.style.display = "block";
		var x = this.mousePageX + this.getPixelX(4);
		var y = this.mousePageY - this.getPixelY(9);
		if(this.mousePageX + this.tooltipCanvas.width + 2 > window.innerWidth) {
			x = window.innerWidth - this.tooltipCanvas.width - 2;
		}
		if(this.mousePageY + this.tooltipCanvas.height + 2 > window.innerHeight) {
			y = window.innerHeight - this.tooltipCanvas.height - 2;
			if(y < 0) {
				y = 0;
			}
		}
		this.tooltipCanvas.style.left = x + "px";
		this.tooltipCanvas.style.top = y + "px";
	}
	
	updateIconFromBytes(arr) {
		if(!this.iconCanvas) {
			this.iconCanvas = document.createElement("canvas");
			this.iconCanvas.width = 64;
			this.iconCanvas.height = 64;
			this.iconContext = this.iconCanvas.getContext("2d");
		}
		var dat = this.iconContext.createImageData(64, 64);
		for(var i = 0, l = 64*64*4; i < l; ++i) {
			dat.data[i] = arr[i];
		}
		this.iconContext.putImageData(dat, 0, 0);
	}
	
}

</script>
<script type="text/javascript">
window.addEventListener("load", () => {
	new ServerEmbed(document.getElementById("embed"), "75%").ping("wss://"+window.location.hostname, "", "", "", "hideCracked");
});
</script>
</head>
    <style>
        #embed {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%); /* Centers the element relative to its own size */
}
    </style>
<body style="background-color: #000000;">
<div id="embed"></div>
</body>
</html>
